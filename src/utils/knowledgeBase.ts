
export interface KnowledgeItem {
  id: string;
  category: string;
  question: string;
  answer: string;
  keywords: string[];
}

const knowledgeBase: Record<string, KnowledgeItem[]> = {
  ru: [
    {
      id: '1',
      category: 'hr',
      question: 'Как оформить отпуск?',
      answer: 'Для оформления отпуска необходимо:\n\n1. Подать заявление на отпуск не менее чем за 14 дней до начала отпуска\n2. Согласовать заявление с непосредственным руководителем\n3. Получить подпись руководителя структурного подразделения\n4. Передать заявление в отдел кадров\n5. Получить приказ о предоставлении отпуска\n\nОбязательные документы: заявление, график отпусков, справка о неиспользованных днях отпуска.',
      keywords: ['отпуск', 'заявление', 'отдых', 'кадры', 'документы', 'согласование']
    },
    {
      id: '2',
      category: 'trips',
      question: 'Процедура служебной командировки',
      answer: 'Порядок оформления служебной командировки:\n\n1. Подготовка служебной записки с обоснованием необходимости командировки\n2. Согласование с руководителем\n3. Оформление командировочного удостоверения\n4. Получение аванса на командировочные расходы\n5. Бронирование билетов и гостиницы\n6. По возвращении - подача авансового отчета в течение 3 рабочих дней\n\nНормы возмещения расходов устанавливаются действующим законодательством.',
      keywords: ['командировка', 'служебная', 'поездка', 'авансовый отчет', 'расходы', 'удостоверение']
    },
    {
      id: '3',
      category: 'documents',
      question: 'Требования к оформлению служебной записки',
      answer: 'Служебная записка должна содержать:\n\n1. Наименование органа\n2. Дата и регистрационный номер\n3. Адресат (кому направляется)\n4. Заголовок к тексту\n5. Текст записки с четким изложением вопроса\n6. Подпись должностного лица с расшифровкой\n7. Печать (при необходимости)\n\nТекст должен быть кратким, конкретным, написан официально-деловым стилем. Шрифт Times New Roman, 14 размер, межстрочный интервал 1,5.',
      keywords: ['служебная записка', 'документооборот', 'оформление', 'требования', 'регистрация']
    },
    {
      id: '4',
      category: 'ethics',
      question: 'Этические нормы при работе с гражданами',
      answer: 'При работе с гражданами государственный служащий обязан:\n\n1. Проявлять вежливость, тактичность и внимательность\n2. Не допускать проявлений бюрократизма\n3. Предоставлять полную и достоверную информацию\n4. Соблюдать установленные сроки рассмотрения обращений\n5. Обеспечивать равное отношение ко всем гражданам\n6. Не разглашать персональные данные\n7. Избегать конфликта интересов\n\nЗапрещается: грубость, предвзятость, требование незаконных документов или платежей.',
      keywords: ['этика', 'граждане', 'обращения', 'вежливость', 'конфликт интересов', 'персональные данные']
    },
    {
      id: '5',
      category: 'approvals',
      question: 'Порядок согласования проектов документов',
      answer: 'Согласование проектов документов проводится в следующем порядке:\n\n1. Подготовка проекта исполнителем\n2. Внутреннее согласование с заинтересованными подразделениями\n3. Правовая экспертиза (при необходимости)\n4. Согласование с руководителем структурного подразделения\n5. Согласование с заместителем руководителя органа\n6. Окончательное согласование с руководителем органа\n\nВизы согласования ставятся на оборотной стороне последнего листа документа или на отдельном листе согласования.',
      keywords: ['согласование', 'проект', 'документ', 'виза', 'экспертиза', 'руководитель']
    },
    {
      id: '6',
      category: 'citizens',
      question: 'Сроки рассмотрения обращений граждан',
      answer: 'Установлены следующие сроки рассмотрения обращений:\n\n1. Письменные обращения - до 15 рабочих дней\n2. Обращения, требующие дополнительного изучения - до 30 рабочих дней\n3. Устные обращения - безотлагательно, но не позднее 15 рабочих дней\n4. Жалобы на действия должностных лиц - до 15 рабочих дней\n5. Повторные обращения - в сроки, установленные для первичных обращений\n\nПри необходимости продления срока заявитель уведомляется письменно с указанием причин.',
      keywords: ['обращения', 'граждане', 'сроки', 'рассмотрение', 'жалобы', 'письменные', 'устные']
    }
  ],
  kz: [
    {
      id: '1',
      category: 'hr',
      question: 'Демалысты қалай ресімдеу керек?',
      answer: 'Демалысты ресімдеу үшін қажет:\n\n1. Демалыс басталғанға дейін кемінде 14 күн бұрын өтініш беру\n2. Өтінішті тікелей басшымен келісу\n3. Құрылымдық бөлімше басшысының қолын алу\n4. Өтінішті кадр бөліміне тапсыру\n5. Демалыс беру туралы бұйрық алу\n\nМіндетті құжаттар: өтініш, демалыс кестесі, пайдаланылмаған демалыс күндері туралы анықтама.',
      keywords: ['демалыс', 'өтініш', 'дем алу', 'кадрлар', 'құжаттар', 'келісу']
    },
    {
      id: '2',
      category: 'trips',
      question: 'Қызметтік іссапар рәсімі',
      answer: 'Қызметтік іссапарды ресімдеу тәртібі:\n\n1. Іссапардың қажеттілігін негіздейтін қызметтік жазба дайындау\n2. Басшымен келісу\n3. Іссапар куәлігін ресімдеу\n4. Іссапар шығыстарына аванс алу\n5. Билет пен қонақ үйді брондау\n6. Қайтып келген соң - 3 жұмыс күні ішінде авансттық есепті тапсыру\n\nШығыстарды өтеу нормалары қолданыстағы заңнамамен белгіленеді.',
      keywords: ['іссапар', 'қызметтік', 'сапар', 'авансттық есеп', 'шығыстар', 'куәлік']
    },
    {
      id: '3',
      category: 'documents',
      question: 'Қызметтік жазбаны ресімдеу талаптары',
      answer: 'Қызметтік жазбада болуы тиіс:\n\n1. Орган атауы\n2. Күні және тіркеу нөмірі\n3. Алушы (кімге жіберіледі)\n4. Мәтінге тақырып\n5. Мәселені нақты баяндайтын мәтін\n6. Лауазымды тұлғаның қолы мен расталуы\n7. Мөр (қажет болған жағдайда)\n\nМәтін қысқа, нақты, ресми-іскерлік стильде жазылуы тиіс. Times New Roman қарпі, 14 өлшем, жолдар арасы 1,5.',
      keywords: ['қызметтік жазба', 'құжат айналымы', 'ресімдеу', 'талаптар', 'тіркеу']
    },
    {
      id: '4',
      category: 'ethics',
      question: 'Азаматтармен жұмыс істегендегі этикалық нормалар',
      answer: 'Азаматтармен жұмыс істегенде мемлекеттік қызметші міндетті:\n\n1. Сыпайылық, тактілік және назарлылық көрсету\n2. Бюрократизм көрінісіне жол бермеу\n3. Толық және дұрыс ақпарат беру\n4. Өтініштерді қарау мерзімдерін сақтау\n5. Барлық азаматтарға тең қарым-қатынас жасау\n6. Жеке деректерді жария етпеу\n7. Мүдделер қайшылығынан аулақ болу\n\nТыйым салынады: дөрекілік, жақтаушылық, заңсыз құжаттар немесе төлемдер талап ету.',
      keywords: ['этика', 'азаматтар', 'өтініштер', 'сыпайылық', 'мүдделер қайшылығы', 'жеке деректер']
    },
    {
      id: '5',
      category: 'approvals',
      question: 'Құжат жобаларын келісу тәртібі',
      answer: 'Құжат жобаларын келісу мына тәртіппен жүргізіледі:\n\n1. Орындаушы жобаны дайындау\n2. Мүдделі бөлімшелермен ішкі келісу\n3. Құқықтық сараптама (қажет болған жағдайда)\n4. Құрылымдық бөлімше басшысымен келісу\n5. Орган басшысының орынбасарымен келісу\n6. Орган басшысымен түпкілікті келісу\n\nКелісу визалары құжаттың соңғы парағының кері жағына немесе бөлек келісу парағына қойылады.',
      keywords: ['келісу', 'жоба', 'құжат', 'виза', 'сараптама', 'басшы']
    },
    {
      id: '6',
      category: 'citizens',
      question: 'Азаматтардың өтініштерін қарау мерзімдері',
      answer: 'Өтініштерді қарау мерзімдері белгіленген:\n\n1. Жазбаша өтініштер - 15 жұмыс күніне дейін\n2. Қосымша зерттеуді талап ететін өтініштер - 30 жұмыс күніне дейін\n3. Ауызша өтініштер - дереу, бірақ 15 жұмыс күніне дейін\n4. Лауазымды тұлғалардың әрекеттеріне шағымдар - 15 жұмыс күніне дейін\n5. Қайталама өтініштер - алғашқы өтініштер үшін белгіленген мерзімде\n\nМерзімді ұзарту қажет болған жағдайда өтініш берушіге себептерін көрсете отырып жазбаша хабарланады.',
      keywords: ['өтініштер', 'азаматтар', 'мерзімдер', 'қарау', 'шағымдар', 'жазбаша', 'ауызша']
    }
  ]
};

export const searchKnowledgeBase = (query: string, language: 'ru' | 'kz'): string => {
  const items = knowledgeBase[language] || knowledgeBase.ru;
  const queryLower = query.toLowerCase();
  
  // Поиск по ключевым словам и тексту вопроса
  let bestMatch = null;
  let maxScore = 0;
  
  for (const item of items) {
    let score = 0;
    
    // Проверяем совпадения с ключевыми словами
    for (const keyword of item.keywords) {
      if (queryLower.includes(keyword.toLowerCase())) {
        score += 2;
      }
    }
    
    // Проверяем совпадения с вопросом
    const questionWords = item.question.toLowerCase().split(' ');
    for (const word of questionWords) {
      if (queryLower.includes(word) && word.length > 2) {
        score += 1;
      }
    }
    
    if (score > maxScore) {
      maxScore = score;
      bestMatch = item;
    }
  }
  
  if (bestMatch && maxScore > 0) {
    return bestMatch.answer;
  }
  
  // Если точного совпадения нет, возвращаем общий ответ
  const defaultResponses = {
    ru: 'Извините, я не нашел точного ответа на ваш вопрос. Пожалуйста, уточните запрос или выберите одну из категорий в боковой панели. Вы также можете связаться с отделом кадров или вашим непосредственным руководителем для получения подробной консультации.',
    kz: 'Кешіріңіз, сіздің сұрағыңызға дәл жауап таба алмадым. Сұранысты нақтылаңыз немесе бүйір панельдегі санаттардың бірін таңдаңыз. Толық консультация алу үшін кадр бөліміне немесе тікелей басшыңызға хабарласуыңызға болады.'
  };
  
  return defaultResponses[language];
};
